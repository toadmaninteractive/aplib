-module(iso8601_tests).

%% Include files

-include_lib("eunit/include/eunit.hrl").

%% Exported functions

-export([]).

%% API

-define(parse_dt(A, B), ?assertEqual(iso8601:parse_datetime(A), B)).
-define(parse_t(A, B), ?assertEqual(iso8601:parse_time(A), B)).
-define(parse_d(A, B), ?assertEqual(iso8601:parse_date(A), B)).
-define(parse_dtm(A, B), ?assertEqual(iso8601:parse_datetimems(A), B)).
-define(parse_dtmz(A, B), ?assertEqual(iso8601:parse_datetimems_zone(A), B)).

datetime_test() ->
    ?parse_dt(<<"2005-08">>,                      {{2005, 8, 1}, {0, 0, 0}}),
    ?parse_dt(<<"20050809">>,                     {{2005, 8, 9}, {0, 0, 0}}),
    ?parse_dt(<<"2005-08-09">>,                   {{2005, 8, 9}, {0, 0, 0}}),
    ?parse_dt(<<"20050809T183142">>,              {{2005, 8, 9}, {18, 31, 42}}),
    ?parse_dt(<<"2005-08-09T18:31:42">>,          {{2005, 8, 9}, {18, 31, 42}}),
    % miliseconds
    ?parse_dt(<<"2005-08-09T18:31:42.201">>,      {{2005, 8, 9}, {18, 31, 42}}),
    % time zone
    ?parse_dt(<<"2005-08-09Z">>,                  {{2005, 8, 9}, {0, 0, 0}}),
    ?parse_dt(<<"2005-08-09T18:31:42Z">>,         {{2005, 8, 9}, {18, 31, 42}}),
    ?parse_dt(<<"20050809T183142+03">>,           {{2005, 8, 9}, {18, 31, 42}}),
    ?parse_dt(<<"20050809T183142-03">>,           {{2005, 8, 9}, {18, 31, 42}}),
    ?parse_dt(<<"2005-08-09T18:31:42+03">>,       {{2005, 8, 9}, {18, 31, 42}}),
    ?parse_dt(<<"2005-08-09T18:31:42-03">>,       {{2005, 8, 9}, {18, 31, 42}}),
    ?parse_dt(<<"20050809T183142+0330">>,         {{2005, 8, 9}, {18, 31, 42}}),
    ?parse_dt(<<"20050809T183142-0330">>,         {{2005, 8, 9}, {18, 31, 42}}),
    ?parse_dt(<<"2005-08-09T18:31:42+03:30">>,    {{2005, 8, 9}, {18, 31, 42}}),
    ?parse_dt(<<"2005-08-09T18:31:42-03:30">>,    {{2005, 8, 9}, {18, 31, 42}}),
    ?parse_dt(<<"2005-08-09T18:31:42+0000">>,     {{2005, 8, 9}, {18, 31, 42}}),
    ok.

time_test() ->
    ?parse_t(<<"1831">>,                         {18, 31, 0}),
    ?parse_t(<<"18:31">>,                        {18, 31, 0}),
    ?parse_t(<<"183142">>,                       {18, 31, 42}),
    ?parse_t(<<"18:31:42">>,                     {18, 31, 42}),
    % miliseconds
    ?parse_t(<<"18:31:42.201">>,                 {18, 31, 42}),
    % time zone
    ?parse_t(<<"183142+03">>,                    {18, 31, 42}),
    ?parse_t(<<"183142-03">>,                    {18, 31, 42}),
    ?parse_t(<<"18:31:42+03">>,                  {18, 31, 42}),
    ?parse_t(<<"18:31:42-03">>,                  {18, 31, 42}),
    ?parse_t(<<"183142+0330">>,                  {18, 31, 42}),
    ?parse_t(<<"183142-0330">>,                  {18, 31, 42}),
    ?parse_t(<<"18:31:42+03:30">>,               {18, 31, 42}),
    ?parse_t(<<"18:31:42-03:30">>,               {18, 31, 42}),
    ?parse_t(<<"18:31:42+0000">>,                {18, 31, 42}),
    ok.

date_test() ->
    ?parse_d(<<"2005-08">>,                      {2005, 8, 1}),
    ?parse_d(<<"20050809">>,                     {2005, 8, 9}),
    ?parse_d(<<"2005-08-09">>,                   {2005, 8, 9}),
    % time zone
    ?parse_d(<<"2005-08-09Z">>,                  {2005, 8, 9}),
    ?parse_d(<<"2005-08-09+0000">>,              {2005, 8, 9}),
    ok.

datetimems_test() ->
    ?parse_dtm(<<"2005-08-09T18:31:42.100+0000">>,     {{2005, 8, 9}, {18, 31, 42.1}}),
    ?parse_dtm(<<"2005-08-09T18:31:42.009+0000">>,     {{2005, 8, 9}, {18, 31, 42.009}}),
    ?parse_dtmz(<<"2005-08-09T18:31:42-03:30">>,       {{{2005, 8, 9}, {18, 31, 42.0}}, {-3, 30}}),
    ?parse_dtmz(<<"2005-08-09+0000">>,                 {{{2005, 8, 9}, {0, 0, 0.0}}, {0, 0}}),
    ok.

%% Local functions
